<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pattern Avoidance - 정교한 컨트롤 및 반사신경 훈련</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4133279395991822" crossorigin="anonymous"></script>
    <style>
        :root { --bg: #0c0c0c; --point: #f1c40f; --danger: #e74c3c; --text: #ffffff; --card: #1a1a1a; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Pretendard', sans-serif; overflow-x: hidden; display: flex; flex-direction: column; align-items: center; }
        
        /* Game Hub 스타일 네비게이션 */
        header { width: 100%; height: 60px; background: #000; border-bottom: 2px solid var(--point); display: flex; align-items: center; padding: 0 20px; box-sizing: border-box; position: sticky; top: 0; z-index: 1000; }
        .btn-hub { padding: 8px 16px; background: transparent; color: var(--point); text-decoration: none; font-weight: bold; border: 1px solid var(--point); border-radius: 4px; transition: 0.3s; }
        .btn-hub:hover { background: var(--point); color: #000; }

        #game-container { position: relative; width: 100%; min-height: 700px; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        canvas { background: #000; border: 4px solid #333; display: none; box-shadow: 0 0 20px rgba(241, 196, 15, 0.2); }

        /* UI 레이어 */
        .overlay { text-align: center; background: var(--card); padding: 40px; border-radius: 15px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #start-screen, #result-screen { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        
        input { padding: 15px; font-size: 18px; border-radius: 5px; border: 1px solid #444; background: #000; color: #fff; width: 280px; text-align: center; }
        input:focus { outline: none; border-color: var(--point); }
        
        button { padding: 15px 50px; font-size: 20px; background: var(--point); border: none; cursor: pointer; font-weight: bold; border-radius: 5px; transition: transform 0.2s; }
        button:hover { transform: scale(1.05); background: #d4ac0d; }

        #status-ui { width: 400px; display: none; justify-content: space-between; font-size: 18px; font-weight: bold; margin-bottom: 15px; padding: 10px; border-bottom: 1px solid #333; }
        .hp-bar { color: var(--danger); }

        /* SEO 컨텐츠 영역 (대폭 강화) */
        #seo-content { width: 90%; max-width: 900px; padding: 80px 0; color: #aaa; line-height: 2; text-align: justify; margin-top: 50px; }
        .seo-box { background: #111; padding: 30px; border-radius: 10px; border-left: 5px solid var(--point); margin-bottom: 30px; }
        #version-tag { position: fixed; bottom: 10px; right: 10px; font-size: 12px; color: #444; }
    </style>
</head>
<body>

    <header>
        <a href="https://game-hub-steel-eight.vercel.app/" class="btn-hub">← GAME HUB</a>
        <div style="margin-left: 20px; font-weight: bold; color: var(--point);">PATTERN AVOIDANCE v1.1.7</div>
    </header>

    <div id="game-container">
        <div id="start-screen" class="overlay">
            <h1 style="font-size: 2.5rem; color: var(--point); margin: 0;">반사신경 테스트</h1>
            <p style="color: #888;">언더테일 스타일의 패턴 피하기 훈련</p>
            <input type="text" id="username" placeholder="랭킹에 등록할 이름" maxlength="12">
            <button onclick="checkStart()">훈련 시작</button>
            <div style="font-size: 14px; color: #555; margin-top: 10px;">
                조작: WASD | 중단: ESC
            </div>
        </div>

        <div id="result-screen" class="overlay" style="display:none;">
            <h2 id="result-msg" style="font-size: 2rem; color: var(--point);">기록 측정 완료</h2>
            <div style="background: #000; padding: 20px; border-radius: 10px; margin: 10px 0; width: 200px;">
                <p style="margin: 0; font-size: 14px; color: #888;">최종 생존 시간</p>
                <p id="result-time" style="font-size: 2.5rem; font-weight: bold; margin: 5px 0;">0.0s</p>
            </div>
            <p id="save-status" style="font-size: 14px; color: var(--point);">기록을 서버에 전송 중...</p>
            <button onclick="location.reload()">다시 도전</button>
        </div>

        <div id="status-ui">
            <div id="ui-name">PLAYER</div>
            <div class="hp-bar">HP: <span id="hp-val">5</span></div>
            <div id="ui-timer" style="color: var(--point);">0.0s</div>
        </div>
        <canvas id="gameCanvas" width="400" height="400"></canvas>
    </div>

    <section id="seo-content">
        <div class="seo-box">
            <h3>1. 패턴 피하기(Pattern Avoidance) 게임의 개요</h3>
            <p>본 게임은 사용자의 시각적 반응 속도와 미세한 움직임 제어 능력을 측정하고 향상시키기 위해 개발된 고난도 트레이닝 툴입니다. 화면 중앙의 제한된 사각형 공간 내에서 무작위로 발생하는 레이저 패턴을 회피하며 생존 시간을 기록하는 방식으로 진행됩니다. 이는 단순한 오락을 넘어 전문 게이머들이 필요로 하는 '탄막 회피'와 '위치 선정' 능력을 극대화하는 데 중점을 둡니다.</p>
        </div>

        <div class="seo-box">
            <h3>2. 훈련의 기술적 메커니즘과 인지 능력 향상</h3>
            <p>게임 내에서 발생하는 가로 및 세로 레이저는 발사 전 '노란색 예고선'을 통해 위치를 암시합니다. 사용자는 이 짧은 예고 시간(약 0.8초) 동안 뇌의 후두엽에서 시각 정보를 처리하고, 운동 피질을 통해 손가락 근육으로 정교한 이동 명령을 내려야 합니다. 이러한 반복적 자극은 뇌신경 가소성을 자극하여 신경 전달 속도를 단축시키는 효과가 있습니다. 특히 소수점 첫째 자리까지 기록되는 정밀한 타이밍 시스템은 사용자가 자신의 한계를 명확히 인지하고 데이터 기반의 실력 향상을 꾀할 수 있도록 돕습니다.</p>
        </div>

        <div class="seo-box">
            <h3>3. FPS 및 액션 게임 실전 적용성</h3>
            <p>대부분의 FPS(1인칭 슈팅) 게임이나 탄막 슈팅 게임에서 생존은 승리의 가장 핵심적인 요소입니다. 패턴 피하기 훈련을 통해 단련된 공간 인지 능력은 적의 투사체를 피하거나 유리한 포지션을 선점하는 데 결정적인 역할을 합니다. 본 소프트웨어는 언더테일(Undertale)의 전투 방식에서 영감을 얻어 제작되었으며, 협소한 구역에서의 회피 기동을 강제함으로써 사용자의 집중력을 한계치까지 끌어올립니다. 플레이어는 매 게임마다 다른 무작위 패턴에 노출되어 매너리즘에 빠지지 않는 지속적인 훈련이 가능합니다.</p>
        </div>

        <div class="seo-box">
            <h3>4. 향후 업데이트 및 랭킹 시스템 안내</h3>
            <p>현재 버전 v1.1.7에서는 기본적인 가로/세로 레이저 회피 로직을 완성하였으며, 사용자의 기록은 Firebase Firestore 데이터베이스인 'avoidance_rankings' 컬렉션에 실시간으로 안전하게 저장됩니다. 추후 업데이트를 통해 회전하는 레이저, 추적 미사일 패턴, 보스전 모드 등을 추가할 예정입니다. 또한, 전 세계 유저들의 기록을 비교할 수 있는 실시간 리더보드 기능을 통해 자신의 순위를 확인하고 동기부여를 얻을 수 있는 환경을 구축할 것입니다. 모든 기록은 공정한 경쟁을 위해 엄격한 검증 과정을 거쳐 반영됩니다.</p>
        </div>
    </section>

    <div id="version-tag">v1.1.7</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCWvmTD7ZqrM8QS2jAtIoxyYw9zDghyyZo",
            authDomain: "dummy-server-ff1b9.firebaseapp.com",
            projectId: "dummy-server-ff1b9",
            storageBucket: "dummy-server-ff1b9.firebasestorage.app",
            messagingSenderId: "275700573811",
            appId: "1:275700573811:web:bb1290a5e5ec97a73cac06"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = 'WAIT';
        let player = { x: 200, y: 200, r: 8, hp: 5, speed: 4 };
        let lasers = [];
        let startTime = 0;
        let survivedTime = "0.0";
        let keys = {};
        let userName = "";

        window.addEventListener('keydown', (e) => { 
            keys[e.code] = true; 
            if(e.code === 'Escape' && (gameState === 'PLAY' || gameState === 'READY')) endGame(); 
        });
        window.addEventListener('keyup', (e) => { keys[e.code] = false; });

        window.checkStart = function() {
            userName = document.getElementById('username').value.trim();
            if(!userName) { alert("이름을 입력해주세요!"); return; }
            
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('status-ui').style.display = 'flex';
            document.getElementById('ui-name').innerText = userName;
            canvas.style.display = 'block';
            startReady();
        }

        function startReady() {
            gameState = 'READY';
            let count = 3;
            let timer = setInterval(() => {
                if(gameState === 'END') { clearInterval(timer); return; }
                
                draw();
                ctx.fillStyle = "#f1c40f";
                ctx.font = "bold 50px Pretendard";
                ctx.textAlign = "center";
                ctx.fillText(count > 0 ? count : "GO!", 200, 220);
                
                if(count < 0) {
                    clearInterval(timer);
                    gameState = 'PLAY';
                    startTime = Date.now();
                    spawnLaser();
                    gameLoop();
                }
                count--;
            }, 800);
        }

        function spawnLaser() {
            if(gameState !== 'PLAY') return;
            const type = Math.random() > 0.5 ? 'H' : 'V';
            const pos = Math.random() * 360 + 20;
            lasers.push({ type: type, pos: pos, stage: 'WARN', timer: Date.now() });
            
            // 난이도 상승 (시간이 지날수록 생성 주기 단축)
            let interval = Math.max(300, 700 - (parseFloat(survivedTime) * 10));
            setTimeout(spawnLaser, interval);
        }

        function update() {
            if(gameState !== 'PLAY') return;

            if(keys['KeyW'] && player.y > player.r) player.y -= player.speed;
            if(keys['KeyS'] && player.y < canvas.height - player.r) player.y += player.speed;
            if(keys['KeyA'] && player.x > player.r) player.x -= player.speed;
            if(keys['KeyD'] && player.x < canvas.width - player.r) player.x += player.speed;

            survivedTime = ((Date.now() - startTime) / 1000).toFixed(1);
            document.getElementById('ui-timer').innerText = survivedTime + 's';

            const now = Date.now();
            for(let i = lasers.length - 1; i >= 0; i--) {
                let l = lasers[i];
                if(l.stage === 'WARN' && now - l.timer > 800) {
                    l.stage = 'FIRE';
                    l.timer = now;
                } else if(l.stage === 'FIRE') {
                    let hit = false;
                    if(l.type === 'H' && Math.abs(player.y - l.pos) < player.r + 10) hit = true;
                    if(l.type === 'V' && Math.abs(player.x - l.pos) < player.r + 10) hit = true;
                    
                    if(hit) {
                        player.hp -= 1;
                        document.getElementById('hp-val').innerText = player.hp;
                        lasers.splice(i, 1);
                        if(player.hp <= 0) endGame();
                        continue;
                    }
                    if(now - l.timer > 250) lasers.splice(i, 1);
                }
            }
        }

        function draw() {
            ctx.fillStyle = "#000";
            ctx.fillRect(0,0,400,400);

            // 플레이어
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
            ctx.fillStyle = "#e74c3c";
            ctx.fill();
            ctx.closePath();

            // 레이저
            lasers.forEach(l => {
                ctx.beginPath();
                if(l.stage === 'WARN') {
                    ctx.strokeStyle = "rgba(241, 196, 15, 0.4)";
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                } else {
                    ctx.strokeStyle = "#fff";
                    ctx.lineWidth = 20;
                    ctx.setLineDash([]);
                }
                if(l.type === 'H') { ctx.moveTo(0, l.pos); ctx.lineTo(400, l.pos); }
                else { ctx.moveTo(l.pos, 0); ctx.lineTo(l.pos, 400); }
                ctx.stroke();
            });
        }

        function gameLoop() {
            if(gameState !== 'PLAY') return;
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        async function endGame() {
            if(gameState === 'END') return;
            gameState = 'END';
            canvas.style.display = 'none';
            document.getElementById('status-ui').style.display = 'none';
            document.getElementById('result-screen').style.display = 'flex';
            document.getElementById('result-time').innerText = survivedTime + 's';

            // Firebase 저장
            try {
                await addDoc(collection(db, "avoidance_rankings"), {
                    name: userName,
                    score: parseFloat(survivedTime),
                    createdAt: serverTimestamp()
                });
                document.getElementById('save-status').innerText = "기록이 성공적으로 저장되었습니다.";
            } catch (e) {
                console.error(e);
                document.getElementById('save-status').innerText = "저장 실패 (네트워크 확인)";
                document.getElementById('save-status').style.color = "#e74c3c";
            }
        }
    </script>
</body>
</html>
