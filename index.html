<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pattern Avoidance - 정교한 컨트롤 훈련</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4133279395991822" crossorigin="anonymous"></script>
    <style>
        :root { --bg: #0c0c0c; --point: #f1c40f; --danger: #e74c3c; --text: #ffffff; --card: #1a1a1a; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Pretendard', sans-serif; overflow-x: hidden; display: flex; flex-direction: column; align-items: center; }
        
        /* 참고 사이트 스타일 상단 바 */
        header { width: 100%; height: 65px; background: #000; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; box-sizing: border-box; position: sticky; top: 0; z-index: 1000; }
        .btn-hub { padding: 10px 20px; background: transparent; color: var(--point); text-decoration: none; font-weight: bold; border: 2px solid var(--point); border-radius: 5px; transition: 0.3s; font-size: 14px; }
        .btn-hub:hover { background: var(--point); color: #000; }

        #game-container { position: relative; width: 100%; min-height: 650px; display: flex; justify-content: center; align-items: center; flex-direction: column; margin-top: 20px; }
        canvas { background: #000; border: 4px solid #fff; display: none; box-shadow: 0 0 25px rgba(255, 255, 255, 0.1); }

        /* UI 레이어 */
        .overlay { text-align: center; background: var(--card); padding: 50px; border-radius: 20px; border: 1px solid #333; min-width: 320px; }
        #start-screen, #result-screen { display: flex; flex-direction: column; align-items: center; gap: 25px; }
        
        input { padding: 15px; font-size: 18px; border-radius: 8px; border: 1px solid #444; background: #000; color: #fff; width: 250px; text-align: center; margin-bottom: 10px; }
        input:focus { outline: none; border-color: var(--point); }
        
        .btn-main { padding: 15px 60px; font-size: 20px; background: var(--point); border: none; cursor: pointer; font-weight: bold; border-radius: 8px; transition: 0.2s; color: #000; }
        .btn-main:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(241, 196, 15, 0.3); }

        #status-ui { width: 400px; display: none; justify-content: space-between; font-size: 20px; font-weight: bold; margin-bottom: 15px; color: #fff; }
        .hp-bar { color: var(--danger); }

        /* SEO 컨텐츠 영역 */
        #seo-content { width: 90%; max-width: 900px; padding: 60px 0; color: #777; line-height: 1.9; }
        .seo-section { margin-bottom: 40px; border-bottom: 1px solid #222; padding-bottom: 20px; }
        h3 { color: var(--point); }
        #version-tag { position: fixed; bottom: 10px; right: 10px; font-size: 12px; color: #333; }
    </style>
</head>
<body>

    <header>
        <div style="font-size: 20px; font-weight: 900; letter-spacing: 1px;">PATTERN <span style="color: var(--point);">AVOIDANCE</span></div>
        <a href="https://game-hub-steel-eight.vercel.app/" class="btn-hub">← GAME HUB 돌아가기</a>
    </header>

    <div id="game-container">
        <div id="start-screen" class="overlay">
            <h1 style="font-size: 2.5rem; margin: 0;">준비되셨나요?</h1>
            <p style="color: #aaa;">상자 안에서 레이저를 피해 생존하세요.</p>
            <button class="btn-main" onclick="startGame()">START</button>
            <p style="font-size: 14px; color: #555;">[W,A,S,D] 이동 | [ESC] 종료 및 기록저장</p>
        </div>

        <div id="result-screen" class="overlay" style="display:none;">
            <h2 style="color: var(--danger); margin: 0;">GAME OVER</h2>
            <div>
                <p style="margin: 0; color: #888;">당신의 기록</p>
                <h1 id="result-time" style="font-size: 3.5rem; color: var(--point); margin: 10px 0;">0.0s</h1>
            </div>
            <div id="save-form">
                <input type="text" id="username" placeholder="이름을 입력하세요 (미입력 시 익명)" maxlength="10">
                <br>
                <button class="btn-main" id="save-btn" onclick="saveRecord()">기록 저장하기</button>
            </div>
            <button class="btn-main" id="retry-btn" onclick="location.reload()" style="display:none; background: #333; color: #fff;">다시 시도</button>
        </div>

        <div id="status-ui">
            <div>SURVIVAL</div>
            <div class="hp-bar">HP: <span id="hp-val">5</span></div>
            <div id="ui-timer" style="color: var(--point);">0.0s</div>
        </div>
        <canvas id="gameCanvas" width="400" height="400"></canvas>
    </div>

    <section id="seo-content">
        <div class="seo-section">
            <h3>패턴 피하기(Pattern Avoidance)를 통한 인지 능력 강화</h3>
            <p>이 게임은 단순한 회피를 넘어 게이머의 뇌가 시각 정보를 처리하고 운동 명령을 내리는 '반응 지연 시간'을 단축시키는 데 최적화되어 있습니다. 언더테일 스타일의 협소 공간 전투 방식은 플레이어에게 높은 집중력을 요구하며, 무작위로 발생하는 레이저 패턴은 매 순간 새로운 판단을 강제합니다. 이는 실제 배틀로얄 게임이나 FPS 게임에서 투사체를 피하는 미세 컨트롤 능력을 배양하는 데 큰 도움을 줍니다.</p>
        </div>
        <div class="seo-section">
            <h3>데이터 기반의 실력 향상 시스템</h3>
            <p>소수점 첫째 자리까지 정밀하게 측정되는 생존 시간은 사용자가 자신의 성장을 직관적으로 확인할 수 있게 합니다. Firebase Firestore를 연동한 실시간 랭킹 저장 시스템은 다른 플레이어와의 비교를 통해 도전 욕구를 자극합니다. 기록 저장 시 이름을 입력하지 않아도 '익명'으로 처리되어 누구나 부담 없이 자신의 실력을 테스트할 수 있으며, ESC 키를 통한 즉각적인 게임 중단 및 기록 추출 기능은 효율적인 반복 훈련을 가능하게 합니다.</p>
        </div>
        <div class="seo-section">
            <h3>기술적 특징 및 훈련 효과</h3>
            <p>본 소프트웨어는 HTML5 Canvas와 Vanilla JavaScript만을 사용하여 지연 시간을 최소화한 고주사율 렌더링을 구현했습니다. 동적 시력 향상, 손과 눈의 협응력(Hand-Eye Coordination) 강화, 그리고 긴박한 상황에서의 평정심 유지 능력을 목표로 합니다. 지속적인 훈련을 통해 당신의 반응 속도를 한계치까지 끌어올려 보십시오. 레이저의 예고선을 보고 이동하는 아주 짧은 찰나의 순간이 당신의 게임 피지컬을 결정짓는 핵심 요소가 될 것입니다.</p>
        </div>
    </section>

    <div id="version-tag">v1.1.8</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCWvmTD7ZqrM8QS2jAtIoxyYw9zDghyyZo",
            authDomain: "dummy-server-ff1b9.firebaseapp.com",
            projectId: "dummy-server-ff1b9",
            storageBucket: "dummy-server-ff1b9.firebasestorage.app",
            messagingSenderId: "275700573811",
            appId: "1:275700573811:web:bb1290a5e5ec97a73cac06"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = 'WAIT';
        let player = { x: 200, y: 200, r: 8, hp: 5, speed: 4 };
        let lasers = [];
        let startTime = 0;
        let survivedTime = "0.0";
        let keys = {};

        window.addEventListener('keydown', (e) => { 
            keys[e.code] = true; 
            if(e.code === 'Escape' && (gameState === 'PLAY' || gameState === 'READY')) endGame(); 
        });
        window.addEventListener('keyup', (e) => { keys[e.code] = false; });

        window.startGame = function() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('status-ui').style.display = 'flex';
            canvas.style.display = 'block';
            startReady();
        }

        function startReady() {
            gameState = 'READY';
            let count = 3;
            let timer = setInterval(() => {
                if(gameState === 'END') { clearInterval(timer); return; }
                draw();
                ctx.fillStyle = "#f1c40f";
                ctx.font = "bold 50px Pretendard";
                ctx.textAlign = "center";
                ctx.fillText(count > 0 ? count : "GO!", 200, 220);
                if(count < 0) {
                    clearInterval(timer);
                    gameState = 'PLAY';
                    startTime = Date.now();
                    spawnLaser();
                    gameLoop();
                }
                count--;
            }, 800);
        }

        function spawnLaser() {
            if(gameState !== 'PLAY') return;
            const type = Math.random() > 0.5 ? 'H' : 'V';
            const pos = Math.random() * 360 + 20;
            lasers.push({ type: type, pos: pos, stage: 'WARN', timer: Date.now() });
            
            let interval = Math.max(250, 750 - (parseFloat(survivedTime) * 12));
            setTimeout(spawnLaser, interval);
        }

        function update() {
            if(gameState !== 'PLAY') return;
            if(keys['KeyW'] && player.y > player.r) player.y -= player.speed;
            if(keys['KeyS'] && player.y < canvas.height - player.r) player.y += player.speed;
            if(keys['KeyA'] && player.x > player.r) player.x -= player.speed;
            if(keys['KeyD'] && player.x < canvas.width - player.r) player.x += player.speed;

            survivedTime = ((Date.now() - startTime) / 1000).toFixed(1);
            document.getElementById('ui-timer').innerText = survivedTime + 's';

            const now = Date.now();
            for(let i = lasers.length - 1; i >= 0; i--) {
                let l = lasers[i];
                if(l.stage === 'WARN' && now - l.timer > 750) {
                    l.stage = 'FIRE';
                    l.timer = now;
                } else if(l.stage === 'FIRE') {
                    let hit = false;
                    if(l.type === 'H' && Math.abs(player.y - l.pos) < player.r + 10) hit = true;
                    if(l.type === 'V' && Math.abs(player.x - l.pos) < player.r + 10) hit = true;
                    if(hit) {
                        player.hp -= 1;
                        document.getElementById('hp-val').innerText = player.hp;
                        lasers.splice(i, 1);
                        if(player.hp <= 0) endGame();
                        continue;
                    }
                    if(now - l.timer > 200) lasers.splice(i, 1);
                }
            }
        }

        function draw() {
            ctx.fillStyle = "#000";
            ctx.fillRect(0,0,400,400);
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
            ctx.fillStyle = "#e74c3c";
            ctx.fill();
            ctx.closePath();
            lasers.forEach(l => {
                ctx.beginPath();
                if(l.stage === 'WARN') {
                    ctx.strokeStyle = "rgba(241, 196, 15, 0.4)";
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                } else {
                    ctx.strokeStyle = "#fff";
                    ctx.lineWidth = 20;
                    ctx.setLineDash([]);
                }
                if(l.type === 'H') { ctx.moveTo(0, l.pos); ctx.lineTo(400, l.pos); }
                else { ctx.moveTo(l.pos, 0); ctx.lineTo(l.pos, 400); }
                ctx.stroke();
            });
        }

        function gameLoop() {
            if(gameState !== 'PLAY') return;
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function endGame() {
            if(gameState === 'END') return;
            gameState = 'END';
            canvas.style.display = 'none';
            document.getElementById('status-ui').style.display = 'none';
            document.getElementById('result-screen').style.display = 'flex';
            document.getElementById('result-time').innerText = survivedTime + 's';
        }

        window.saveRecord = async function() {
            const name = document.getElementById('username').value.trim() || "익명";
            const saveBtn = document.getElementById('save-btn');
            saveBtn.disabled = true;
            saveBtn.innerText = "저장 중...";

            try {
                await addDoc(collection(db, "avoidance_rankings"), {
                    name: name,
                    score: parseFloat(survivedTime),
                    createdAt: serverTimestamp()
                });
                document.getElementById('save-form').innerHTML = `<p style="color:var(--point); font-weight:bold;">랭킹이 등록되었습니다!</p>`;
                document.getElementById('retry-btn').style.display = 'block';
            } catch (e) {
                console.error(e);
                alert("저장 실패");
                saveBtn.disabled = false;
                saveBtn.innerText = "기록 저장하기";
            }
        }
    </script>
</body>
</html>
